<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ƒê∆°n h√†ng c·ªßa t√¥i ¬∑ Xelloxx</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet"/>
<style>
:root{
  --bg:#080c14;--bg2:#0f1623;--card:#111827;
  --accent:#ff6a00;--accent2:#ff9500;
  --text:#f0f0f0;--muted:#8899aa;
  --border:rgba(255,150,0,0.12);
  --green:#10b981;--red:#ef4444;--yellow:#f59e0b;
}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:'Syne',sans-serif;min-height:100vh;}

/* NAV */
nav{position:fixed;top:0;left:0;right:0;z-index:100;padding:.9rem 2rem;display:flex;align-items:center;justify-content:space-between;background:rgba(8,12,20,.95);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);}
.logo{font-size:1.3rem;font-weight:800;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none;}
.nav-back{display:flex;align-items:center;gap:.4rem;color:var(--muted);text-decoration:none;font-size:.85rem;transition:.2s;}
.nav-back:hover{color:var(--text);}
.nav-user{display:flex;align-items:center;gap:.5rem;font-size:.85rem;color:var(--muted);}
.nav-balance{color:var(--accent);font-weight:700;font-family:'Space Mono',monospace;}

main{padding:5.5rem 1.5rem 3rem;max-width:860px;margin:0 auto;}

/* PAGE TITLE */
.page-header{margin-bottom:2rem;}
.page-header h1{font-size:1.8rem;font-weight:800;display:flex;align-items:center;gap:.6rem;margin-bottom:.3rem;}
.page-header h1 .icon{display:inline-flex;width:2.2rem;height:2.2rem;background:rgba(255,106,0,.15);border:1px solid rgba(255,106,0,.3);border-radius:8px;align-items:center;justify-content:center;font-size:1rem;}
.page-header p{color:var(--muted);font-size:.9rem;}

/* STATS ROW */
.stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:2rem;}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:1.5rem;text-align:center;}
.stat-icon{font-size:1.6rem;margin-bottom:.5rem;}
.stat-num{font-size:2rem;font-weight:800;font-family:'Space Mono',monospace;line-height:1;}
.stat-label{font-size:.8rem;color:var(--muted);margin-top:.4rem;}
.stat-card.yellow .stat-icon{color:var(--yellow);}
.stat-card.yellow .stat-num{color:var(--yellow);}
.stat-card.green .stat-icon{color:var(--green);}
.stat-card.green .stat-num{color:var(--green);}
.stat-card.red .stat-icon{color:var(--red);}
.stat-card.red .stat-num{color:var(--red);}

/* TABS */
.tabs{display:flex;gap:.5rem;margin-bottom:1.5rem;border-bottom:1px solid var(--border);padding-bottom:0;}
.tab{padding:.6rem 1.2rem;background:none;border:none;color:var(--muted);font-family:'Syne',sans-serif;font-size:.9rem;font-weight:600;cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-1px;transition:.2s;}
.tab.active{color:var(--accent);border-bottom-color:var(--accent);}
.tab:hover:not(.active){color:var(--text);}

/* SEARCH */
.search-bar{position:relative;margin-bottom:1.2rem;}
.search-bar input{width:100%;padding:.75rem 1rem .75rem 2.8rem;background:var(--card);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'Syne',sans-serif;font-size:.9rem;outline:none;transition:.2s;}
.search-bar input:focus{border-color:rgba(255,106,0,.4);}
.search-bar .icon{position:absolute;left:.9rem;top:50%;transform:translateY(-50%);color:var(--muted);font-size:1rem;}

/* ORDER LIST */
.order-list{display:flex;flex-direction:column;gap:.8rem;}

.order-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:1.2rem 1.4rem;display:flex;align-items:center;gap:1.2rem;transition:.2s;cursor:pointer;}
.order-card:hover{border-color:rgba(255,106,0,.3);background:#141e2e;}

.order-icon{width:3rem;height:3rem;border-radius:10px;background:rgba(255,106,0,.1);border:1px solid rgba(255,106,0,.2);display:flex;align-items:center;justify-content:center;font-size:1.4rem;flex-shrink:0;}

.order-info{flex:1;min-width:0;}
.order-name{font-weight:700;font-size:.95rem;margin-bottom:.25rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.order-meta{font-size:.78rem;color:var(--muted);display:flex;align-items:center;gap:.7rem;flex-wrap:wrap;}
.order-meta span{display:flex;align-items:center;gap:.25rem;}
.order-id{font-family:'Space Mono',monospace;font-size:.7rem;color:var(--muted);}

.order-right{text-align:right;flex-shrink:0;}
.order-amount{font-family:'Space Mono',monospace;font-weight:700;font-size:1rem;color:var(--accent);margin-bottom:.3rem;}
.order-amount.free{color:var(--green);}

/* STATUS BADGE */
.badge{display:inline-flex;align-items:center;gap:.3rem;padding:.2rem .6rem;border-radius:100px;font-size:.72rem;font-weight:700;}
.badge.done{background:rgba(16,185,129,.12);border:1px solid rgba(16,185,129,.3);color:var(--green);}
.badge.pending{background:rgba(245,158,11,.12);border:1px solid rgba(245,158,11,.3);color:var(--yellow);}
.badge.fail{background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.3);color:var(--red);}

/* DOWNLOAD BTN */
.btn-dl{display:inline-flex;align-items:center;gap:.3rem;padding:.3rem .75rem;background:rgba(255,106,0,.15);border:1px solid rgba(255,106,0,.35);border-radius:7px;color:var(--accent);font-size:.75rem;font-weight:700;text-decoration:none;transition:.2s;margin-top:.3rem;}
.btn-dl:hover{background:rgba(255,106,0,.28);}

/* COUPON TAG */
.coupon-tag{display:inline-flex;align-items:center;gap:.25rem;padding:.15rem .5rem;background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.25);border-radius:6px;font-size:.7rem;color:var(--green);}

/* EMPTY STATE */
.empty{text-align:center;padding:4rem 1rem;}
.empty-icon{font-size:4rem;opacity:.25;margin-bottom:1rem;display:block;}
.empty h3{font-size:1.1rem;font-weight:700;margin-bottom:.5rem;}
.empty p{color:var(--muted);font-size:.88rem;margin-bottom:1.5rem;}
.btn-primary{display:inline-block;padding:.75rem 2rem;background:var(--accent);color:#fff;border-radius:10px;font-weight:700;font-size:.9rem;text-decoration:none;letter-spacing:.5px;transition:.2s;}
.btn-primary:hover{background:#ff9500;transform:translateY(-1px);}

/* MODAL */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:500;align-items:center;justify-content:center;padding:1rem;}
.overlay.open{display:flex;}
.modal{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:2rem;width:100%;max-width:480px;position:relative;}
.modal-close{position:absolute;top:1rem;right:1rem;background:none;border:none;color:var(--muted);font-size:1.3rem;cursor:pointer;transition:.2s;}
.modal-close:hover{color:var(--text);}
.modal h3{font-size:1.2rem;font-weight:800;margin-bottom:1.5rem;padding-right:2rem;}
.detail-row{display:flex;justify-content:space-between;align-items:flex-start;padding:.7rem 0;border-bottom:1px solid var(--border);gap:1rem;}
.detail-row:last-child{border-bottom:none;}
.detail-label{font-size:.82rem;color:var(--muted);}
.detail-value{font-size:.88rem;font-weight:600;text-align:right;max-width:65%;}
.detail-value.mono{font-family:'Space Mono',monospace;font-size:.8rem;}
.detail-value.accent{color:var(--accent);}
.detail-value.green{color:var(--green);}

/* LOADING */
.skeleton{background:linear-gradient(90deg,var(--card) 25%,rgba(255,255,255,.04) 50%,var(--card) 75%);background-size:200% 100%;animation:shimmer 1.4s infinite;border-radius:14px;height:80px;}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

@media(max-width:600px){
  .stats-row{grid-template-columns:1fr 1fr;}.stats-row .stat-card:last-child{grid-column:span 2;}
  .order-card{flex-wrap:wrap;}.order-right{width:100%;display:flex;justify-content:space-between;align-items:center;margin-top:.3rem;}
  .page-header h1{font-size:1.4rem;}
}
</style>
</head>
<body>

<nav>
  <a class="logo" href="/">Xell<span style="color:#ff6a00">o</span>xx</a>
  <a class="nav-back" href="/">
    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
    Trang ch·ªß
  </a>
  <div class="nav-user">
    üë§ <span id="navUser">--</span>
    &nbsp;|&nbsp;
    üí∞ <span class="nav-balance" id="navBal">--</span>ƒë
  </div>
</nav>

<main>
  <div class="page-header">
    <h1><span class="icon">üõç</span> ƒê∆°n h√†ng c·ªßa t√¥i</h1>
    <p>Theo d√µi tr·∫°ng th√°i v√† xem th√¥ng tin t√†i kho·∫£n ƒë√£ mua</p>
  </div>

  <!-- STATS -->
  <div class="stats-row">
    <div class="stat-card yellow">
      <div class="stat-icon">‚è±</div>
      <div class="stat-num" id="statPending">0</div>
      <div class="stat-label">Ch·ªù duy·ªát</div>
    </div>
    <div class="stat-card green">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-num" id="statDone">0</div>
      <div class="stat-label">ƒê√£ duy·ªát</div>
    </div>
    <div class="stat-card red">
      <div class="stat-icon">‚ùå</div>
      <div class="stat-num" id="statFail">0</div>
      <div class="stat-label">T·ª´ ch·ªëi</div>
    </div>
  </div>

  <!-- TABS -->
  <div class="tabs">
    <button class="tab active" onclick="switchTab('all',this)">T·∫•t c·∫£</button>
    <button class="tab" onclick="switchTab('done',this)">ƒê√£ duy·ªát</button>
    <button class="tab" onclick="switchTab('pending',this)">Ch·ªù duy·ªát</button>
    <button class="tab" onclick="switchTab('fail',this)">T·ª´ ch·ªëi</button>
  </div>

  <!-- SEARCH -->
  <div class="search-bar">
    <span class="icon">üîç</span>
    <input type="text" id="searchInput" placeholder="T√¨m theo t√™n s·∫£n ph·∫©m..." oninput="renderList()">
  </div>

  <!-- LIST -->
  <div class="order-list" id="orderList">
    <div class="skeleton"></div>
    <div class="skeleton" style="height:70px;opacity:.6"></div>
    <div class="skeleton" style="height:70px;opacity:.3"></div>
  </div>
</main>

<!-- DETAIL MODAL -->
<div class="overlay" id="modalOverlay" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <h3>üìÑ Chi ti·∫øt ƒë∆°n h√†ng</h3>
    <div id="modalBody"></div>
  </div>
</div>

<script>
let allOrders = [];
let currentTab = 'all';

async function init(){
  // Load user info
  const res = await fetch('/api/me');
  const u = await res.json();
  if(!u.ok){ window.location.href='/login'; return; }
  document.getElementById('navUser').textContent = u.username;
  document.getElementById('navBal').textContent = fmt(u.balance||0);

  // Load orders
  const r = await fetch('/api/my-orders');
  const d = await r.json();
  allOrders = d.orders || [];
  updateStats();
  renderList();
}

function fmt(n){ return new Intl.NumberFormat('vi-VN').format(n); }

function getStatus(o){
  if(o.status === 'fail') return 'fail';
  if(o.file_url) return 'done';
  if(o.status === 'done') return 'done';
  return 'pending';
}

function updateStats(){
  document.getElementById('statPending').textContent = allOrders.filter(o=>getStatus(o)==='pending').length;
  document.getElementById('statDone').textContent    = allOrders.filter(o=>getStatus(o)==='done').length;
  document.getElementById('statFail').textContent    = allOrders.filter(o=>getStatus(o)==='fail').length;
}

function switchTab(tab, btn){
  currentTab = tab;
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderList();
}

function renderList(){
  const q = document.getElementById('searchInput').value.toLowerCase();
  let list = allOrders;
  if(currentTab !== 'all') list = list.filter(o=>getStatus(o)===currentTab);
  if(q) list = list.filter(o=>o.product_name.toLowerCase().includes(q));

  const el = document.getElementById('orderList');
  if(!list.length){
    el.innerHTML = `
      <div class="empty">
        <span class="empty-icon">üõç</span>
        <h3>Ch∆∞a c√≥ ƒë∆°n h√†ng</h3>
        <p>B·∫°n ch∆∞a mua t√†i kho·∫£n n√†o. Kh√°m ph√° ngay!</p>
        <a href="/" class="btn-primary">MUA T√ÄI KHO·∫¢N NGAY</a>
      </div>`;
    return;
  }

  el.innerHTML = list.map(o => {
    const st = getStatus(o);
    const badgeMap = {
      done:    `<span class="badge done">‚úî ƒê√£ duy·ªát</span>`,
      pending: `<span class="badge pending">‚è± Ch·ªù duy·ªát</span>`,
      fail:    `<span class="badge fail">‚úï T·ª´ ch·ªëi</span>`
    };
    const dlBtn = o.file_url
      ? `<a class="btn-dl" href="${o.file_url}" target="_blank">‚¨á T·∫£i file</a>`
      : '';
    const coupon = o.coupon
      ? `<span class="coupon-tag">üè∑ ${o.coupon} -${fmt(o.discount||0)}ƒë</span>` : '';
    const isFree = o.amount === 0;

    return `<div class="order-card" onclick="openModal('${o.id}')">
      <div class="order-icon">üì¶</div>
      <div class="order-info">
        <div class="order-name">${o.product_name}</div>
        <div class="order-meta">
          <span>üïê ${o.created_at}</span>
          ${coupon}
        </div>
        <div class="order-id" style="margin-top:.3rem">#${o.id.slice(0,8).toUpperCase()}</div>
      </div>
      <div class="order-right">
        <div class="order-amount ${isFree?'free':''}">${isFree ? 'FREE' : fmt(o.amount)+'ƒë'}</div>
        ${badgeMap[st]}
        ${dlBtn}
      </div>
    </div>`;
  }).join('');
}

function openModal(id){
  const o = allOrders.find(x=>x.id===id);
  if(!o) return;
  const st = getStatus(o);
  const badgeMap = {
    done:    `<span class="badge done">‚úî ƒê√£ duy·ªát</span>`,
    pending: `<span class="badge pending">‚è± Ch·ªù duy·ªát</span>`,
    fail:    `<span class="badge fail">‚úï T·ª´ ch·ªëi</span>`
  };
  document.getElementById('modalBody').innerHTML = `
    <div class="detail-row"><span class="detail-label">M√£ ƒë∆°n h√†ng</span><span class="detail-value mono">#${o.id.slice(0,8).toUpperCase()}</span></div>
    <div class="detail-row"><span class="detail-label">S·∫£n ph·∫©m</span><span class="detail-value">${o.product_name}</span></div>
    <div class="detail-row"><span class="detail-label">Ng√†y mua</span><span class="detail-value">${o.created_at}</span></div>
    <div class="detail-row"><span class="detail-label">S·ªë ti·ªÅn</span><span class="detail-value accent mono">${o.amount===0?'FREE':fmt(o.amount)+'ƒë'}</span></div>
    ${o.discount>0?`<div class="detail-row"><span class="detail-label">Gi·∫£m gi√° (${o.coupon})</span><span class="detail-value green">-${fmt(o.discount)}ƒë</span></div>`:''}
    <div class="detail-row"><span class="detail-label">Tr·∫°ng th√°i</span><span class="detail-value">${badgeMap[st]}</span></div>
    ${o.file_url?`<div class="detail-row"><span class="detail-label">File</span><span class="detail-value"><a class="btn-dl" href="${o.file_url}" target="_blank">‚¨á T·∫£i file ngay</a></span></div>`:''}
  `;
  document.getElementById('modalOverlay').classList.add('open');
}

function closeModal(){
  document.getElementById('modalOverlay').classList.remove('open');
}

init();
</script>
</body>
</html>
